// import React from 'react';
// import { Link } from 'react-router-dom';
// import { useSelector } from 'react-redux'


// function Sidebar({ hidden }) {

//     const authStatus = useSelector((state) => state.auth.status)
//     // console.log(authStatus);
//     const user = useSelector((state) => state.auth.user);
//     const backupImage = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQFIO8i8i3D60705OwMtBDweKC3aTIkThlqQw&s"

//     const navItems = [

//         {
//             name: "Home",
//             path: "home",
//             svg: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
//                 <path strokeLinecap="round" strokeLinejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
//             </svg>,
//             active: true
//         },
//         {
//             name: "Shorts",
//             path: "/shorts",
//             svg: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
//                 <path strokeLinecap="round" strokeLinejoin="round" d="M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h1.5C5.496 19.5 6 18.996 6 18.375m-3.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-1.5A1.125 1.125 0 0 1 18 18.375M20.625 4.5H3.375m17.25 0c.621 0 1.125.504 1.125 1.125M20.625 4.5h-1.5C18.504 4.5 18 5.004 18 5.625m3.75 0v1.5c0 .621-.504 1.125-1.125 1.125M3.375 4.5c-.621 0-1.125.504-1.125 1.125M3.375 4.5h1.5C5.496 4.5 6 5.004 6 5.625m-3.75 0v1.5c0 .621.504 1.125 1.125 1.125m0 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.5-3.75C5.496 8.25 6 7.746 6 7.125v-1.5M4.875 8.25C5.496 8.25 6 8.754 6 9.375v1.5m0-5.25v5.25m0-5.25C6 5.004 6.504 4.5 7.125 4.5h9.75c.621 0 1.125.504 1.125 1.125m1.125 2.625h1.5m-1.5 0A1.125 1.125 0 0 1 18 7.125v-1.5m1.125 2.625c-.621 0-1.125.504-1.125 1.125v1.5m2.625-2.625c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125M18 5.625v5.25M7.125 12h9.75m-9.75 0A1.125 1.125 0 0 1 6 10.875M7.125 12C6.504 12 6 12.504 6 13.125m0-2.25C6 11.496 5.496 12 4.875 12M18 10.875c0 .621-.504 1.125-1.125 1.125M18 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m-12 5.25v-5.25m0 5.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125m-12 0v-1.5c0-.621-.504-1.125-1.125-1.125M18 18.375v-5.25m0 5.25v-1.5c0-.621.504-1.125 1.125-1.125M18 13.125v1.5c0 .621.504 1.125 1.125 1.125M18 13.125c0-.621.504-1.125 1.125-1.125M6 13.125v1.5c0 .621-.504 1.125-1.125 1.125M6 13.125C6 12.504 5.496 12 4.875 12m-1.5 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M19.125 12h1.5m0 0c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h1.5m14.25 0h1.5" />
//             </svg>,
//             active: authStatus
//         },
//         {
//             name: "Sing Up",
//             path: "/signup",
//             svg: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
//                 <path strokeLinecap="round" strokeLinejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
//             </svg>,
//             active: !authStatus
//         },
//         {
//             name: "Login",
//             path: "/login",
//             svg: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
//                 <path strokeLinecap="round" strokeLinejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
//             </svg>,
//             active: !authStatus
//         },

//     ]
//     // console.log(hidden);
//     return (
//         <>
//             {/* {{ sidebar }} */}
//             {

//                 hidden && (
//                     <aside id="sidebar" className={`fixed top-0 lg:top-5 left-0 z-20 flex flex-col flex-shrink-0 w-52 h-full pt-10 font-normal duration-75 lg:flex transition-width `}
//                         aria-label="Sidebar">



//                         <div className="relative flex flex-col flex-1 min-h-0 pt-0 bg-white  mt-3">
//                             {authStatus && (
//                                 <div className="sm:hidden px-3 pt-6 h-20 border-b border-gray-200">
//                                     <Link to="/your_channel" className="flex items-center gap-3" aria-label="Open your channel">
//                                         {user?.avatar ? (
//                                             <img src={user?.avatar || backupImage} alt={user?.name || 'Profile'} className="w-10 h-10 rounded-full object-cover" />
//                                         ) : (
//                                             <div className="w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-sm font-medium">
//                                                 {user?.name ? user.name.charAt(0).toUpperCase() : 'Y'}
//                                             </div>
//                                         )}
//                                         <div className="flex flex-col">
//                                             <span className="text-sm font-medium  text-gray-900">{user?.name || 'DemoUser'}</span>
//                                             {<span className="text-xs text-gray-500 truncate">{user?.email || 'demo1@gmail.com'}</span>}
//                                         </div>
//                                     </Link>
//                                 </div>
//                             )}

//                             <div className="flex flex-col flex-1 pt-3 pb-4 overflow-y-auto">
//                                 <div className="flex-1 px-3 space-y-1 bg-white divide-y divide-gray-200 ">
//                                     <ul className="">
//                                         {navItems.map((item, index) =>
//                                             item.active ? (
//                                                 <li key={index} >
//                                                     <Link to={item.path} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
//                                                         {item.svg}
//                                                         <span className="ml-3" sidebar-toggle-item>
//                                                             {item.name}
//                                                         </span>
//                                                     </Link>
//                                                 </li>)
//                                                 : null)}

//                                         {authStatus && (
//                                             <>

//                                                 <div className='divide-y divide-gray-200' >
//                                                     <li>
//                                                         <Link to={"/subscriptions"} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
//                                                             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
//                                                                 <path strokeLinecap="round" strokeLinejoin="round" d="M6 6.878V6a2.25 2.25 0 0 1 2.25-2.25h7.5A2.25 2.25 0 0 1 18 6v.878m-12 0c.235-.083.487-.128.75-.128h10.5c.263 0 .515.045.75.128m-12 0A2.25 2.25 0 0 0 4.5 9v.878m13.5-3A2.25 2.25 0 0 1 19.5 9v.878m0 0a2.246 2.246 0 0 0-.75-.128H5.25c-.263 0-.515.045-.75.128m15 0A2.25 2.25 0 0 1 21 12v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6c0-.98.626-1.813 1.5-2.122" />
//                                                             </svg>
//                                                             <span className="ml-3" sidebar-toggle-item>Subscriptions</span>
//                                                         </Link>
//                                                     </li>
//                                                     <li>
//                                                         <h1>You</h1>
//                                                         <Link to={"/your_channel"} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
//                                                             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
//                                                                 <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
//                                                             </svg>
//                                                             <span className="ml-3" sidebar-toggle-item>Your Channel</span>
//                                                         </Link>
//                                                     </li>
//                                                 </div>
//                                                 <li>
//                                                     <Link to={"/history"} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
//                                                         <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
//                                                             <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3" />
//                                                         </svg>
//                                                         <span className="ml-3" sidebar-toggle-item>History</span>
//                                                     </Link>
//                                                 </li>
//                                                 <li>
//                                                     <Link to={"/playlist"} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
//                                                         <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
//                                                             <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
//                                                         </svg>
//                                                         <span className="ml-3" sidebar-toggle-item>Playlist</span>
//                                                     </Link>
//                                                 </li>
//                                                 <div className='divide-y divide-gray-200' >
//                                                     <li>
//                                                         <Link to={"/like"} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
//                                                             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
//                                                                 <path strokeLinecap="round" strokeLinejoin="round" d="M6.633 10.25c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75a.75.75 0 0 1 .75-.75 2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282m0 0h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23H5.904m10.598-9.75H14.25M5.904 18.5c.083.205.173.405.27.602.197.4-.078.898-.523.898h-.908c-.889 0-1.713-.518-1.972-1.368a12 12 0 0 1-.521-3.507c0-1.553.295-3.036.831-4.398C3.387 9.953 4.167 9.5 5 9.5h1.053c.472 0 .745.556.5.96a8.958 8.958 0 0 0-1.302 4.665c0 1.194.232 2.333.654 3.375Z" />
//                                                             </svg>
//                                                             <span className="ml-3" sidebar-toggle-item>Like</span>
//                                                         </Link>
//                                                     </li>
//                                                     <li>
//                                                         <h1>Explore</h1>
//                                                         {/* <Link to={"trending"} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
//                                                             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
//                                                                 <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941" />
//                                                             </svg>
//                                                             <span className="ml-3" sidebar-toggle-item>Trending</span>
//                                                         </Link> */}
//                                                         <Link 
//   to="/trending" 
//   className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group"
// >
//   <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
//     <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941" />
//   </svg>
//   <span className="ml-3" sidebar-toggle-item>Trending</span>
// </Link>

//                                                     </li>
//                                                 </div>
//                                                 <li>
//                                                     <Link to="/music" className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
//                                                         <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
//                                                             <path strokeLinecap="round" strokeLinejoin="round" d="m9 9 10.5-3m0 6.553v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 1 1-.99-3.467l2.31-.66a2.25 2.25 0 0 0 1.632-2.163Zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 0 1-.99-3.467l2.31-.66A2.25 2.25 0 0 0 9 15.553Z" />
//                                                         </svg>
//                                                         <span className="ml-3" sidebar-toggle-item>Music</span>
//                                                     </Link>
//                                                 </li>
//                                                 <div className='divide-y divide-gray-200' >
//                                                     <li>
//                                                         <Link to="/movies" className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
//                                                             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
//                                                                 <path strokeLinecap="round" strokeLinejoin="round" d="m3.75 7.5 16.5-4.125M12 6.75c-2.708 0-5.363.224-7.948.655C2.999 7.58 2.25 8.507 2.25 9.574v9.176A2.25 2.25 0 0 0 4.5 21h15a2.25 2.25 0 0 0 2.25-2.25V9.574c0-1.067-.75-1.994-1.802-2.169A48.329 48.329 0 0 0 12 6.75Zm-1.683 6.443-.005.005-.006-.005.006-.005.005.005Zm-.005 2.127-.005-.006.005-.005.005.005-.005.005Zm-2.116-.006-.005.006-.006-.006.005-.005.006.005Zm-.005-2.116-.006-.005.006-.005.005.005-.005.005ZM9.255 10.5v.008h-.008V10.5h.008Zm3.249 1.88-.007.004-.003-.007.006-.003.004.006Zm-1.38 5.126-.003-.006.006-.004.004.007-.006.003Zm.007-6.501-.003.006-.007-.003.004-.007.006.004Zm1.37 5.129-.007-.004.004-.006.006.003-.004.007Zm.504-1.877h-.008v-.007h.008v.007ZM9.255 18v.008h-.008V18h.008Zm-3.246-1.87-.007.004L6 16.127l.006-.003.004.006Zm1.366-5.119-.004-.006.006-.004.004.007-.006.003ZM7.38 17.5l-.003.006-.007-.003.004-.007.006.004Zm-1.376-5.116L6 12.38l.003-.007.007.004-.004.007Zm-.5 1.873h-.008v-.007h.008v.007ZM17.25 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Zm0 4.5a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z" />
//                                                             </svg>
//                                                             <span className="ml-3" sidebar-toggle-item>Movies</span>
//                                                         </Link>
//                                                     </li>
//                                                     <li>
//                                                         <Link to={"/settings"} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
//                                                             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" class="w-6 h-6">
//                                                                 <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
//                                                                 <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
//                                                             </svg>
//                                                             <span className="ml-3" sidebar-toggle-item>Settings</span>
//                                                         </Link>

//                                                     </li>
//                                                 </div>
//                                             </>
//                                         )}


//                                     </ul>
//                                 </div>
//                             </div>
//                         </div>
//                     </aside>
//                 )

//             }
//             {/* </div> */}
//         </>
//     )
// }

// export default Sidebar






import React, { useEffect, useState } from 'react';
import { Link } from 'react-router-dom';
import { useSelector } from 'react-redux'
import { FiFileText } from 'react-icons/fi';


function Sidebar({ hidden }) {

    const authStatus = useSelector((state) => state.auth.status)
    const user = useSelector((state) => state.auth.user);
    const backupImage = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQFIO8i8i3D60705OwMtBDweKC3aTIkThlqQw&s"

    const [subscriptions, setSubscriptions] = useState([])
    const [loadingSubs, setLoadingSubs] = useState(false)
    const [subsError, setSubsError] = useState(null)

    // useEffect(() => {
    //     // only fetch when logged in
    //     if (!authStatus) return

    //     const controller = new AbortController()
    //     const fetchSubs = async () => {
    //         setLoadingSubs(true)
    //         setSubsError(null)
    //         try {
    //             const res = await fetch('http://localhost:5000/api/v1/subs/mine', {
    //                 method: 'GET',
    //                 headers: {
    //                     'Content-Type': 'application/json',
    //                     // pass token if available in redux user object
    //                     ...(user?.token ? { 'Authorization': `Bearer ${user.token}` } : {})
    //                 },
    //                 signal: controller.signal
    //             })

    //             if (!res.ok) throw new Error(`Fetch failed: ${res.status}`)
    //             const json = await res.json()
    //             // expecting json.data to be an array of subscriptions
    //             setSubscriptions(json.data || [])

    //         } catch (err) {
    //             if (err.name !== 'AbortError') {
    //                 console.error('Failed to load subscriptions', err)
    //                 setSubsError(err.message)
    //             }
    //         } finally {
    //             setLoadingSubs(false)
    //         }
    //     }

    //     fetchSubs()
    //     return () => controller.abort()
    // }, [authStatus, user?.token])
    useEffect(() => {
        if (!authStatus) return;

        const controller = new AbortController();

        const fetchSubs = async () => {
            setLoadingSubs(true);
            setSubsError(null);

            try {
                const headers = { 'Content-Type': 'application/json' };
                const hasToken = !!user?.token;

                if (hasToken) {
                    headers['Authorization'] = `Bearer ${user.token}`;
                }

                const res = await fetch('http://localhost:5000/api/v1/subs/mine', {
                    method: 'GET',
                    headers,
                    // if you rely on session cookies, include credentials
                    ...(hasToken ? {} : { credentials: 'include' }),
                    signal: controller.signal,
                });

                // try to parse JSON (even on non-2xx to get error message)
                const text = await res.text();
                let json;
                try {
                    json = text ? JSON.parse(text) : null;
                } catch (parseErr) {
                    console.warn('Response not JSON:', text);
                }

                if (!res.ok) {
                    const serverMsg = (json && (json.message || json.error)) || text || res.statusText;
                    const errMsg = `Server responded ${res.status}: ${serverMsg}`;
                    console.error(errMsg, json || text);
                    throw new Error(errMsg);
                }

                // success
                setSubscriptions(json?.data || []);
            } catch (err) {
                if (err.name === 'AbortError') {
                    // ignore abort
                    console.log('Subscriptions fetch aborted');
                } else {
                    console.error('Failed to load subscriptions:', err);
                    setSubsError(err.message || 'Unknown error');
                }
            } finally {
                setLoadingSubs(false);
            }
        };

        fetchSubs();
        return () => controller.abort();
    }, [authStatus, user?.token]);


    const navItems = [
        {
            name: "Home",
            path: "home",
            svg: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                <path strokeLinecap="round" strokeLinejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
            </svg>,
            active: true
        },
        {
            name: "Shorts",
            path: "/shorts",
            svg: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                <path strokeLinecap="round" strokeLinejoin="round" d="M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h1.5C5.496 19.5 6 18.996 6 18.375m-3.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-1.5A1.125 1.125 0 0 1 18 18.375M20.625 4.5H3.375m17.25 0c.621 0 1.125.504 1.125 1.125M20.625 4.5h-1.5C18.504 4.5 18 5.004 18 5.625m3.75 0v1.5c0 .621-.504 1.125-1.125 1.125m3.75 0h1.5m-1.5 0A1.125 1.125 0 0 1 18 7.125v-1.5m1.125 2.625c-.621 0-1.125.504-1.125 1.125v1.5m2.625-2.625c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125M18 5.625v5.25M7.125 12h9.75m-9.75 0A1.125 1.125 0 0 1 6 10.875M7.125 12C6.504 12 6 12.504 6 13.125m0-2.25C6 11.496 5.496 12 4.875 12M18 10.875c0 .621-.504 1.125-1.125 1.125M18 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m-12 5.25v-5.25m0 5.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125m-12 0v-1.5c0-.621-.504-1.125-1.125-1.125M18 18.375v-5.25m0 5.25v-1.5c0-.621.504-1.125 1.125-1.125M18 13.125v1.5c0 .621.504 1.125 1.125 1.125M18 13.125c0-.621.504-1.125 1.125-1.125M6 13.125v1.5c0 .621-.504 1.125-1.125 1.125M6 13.125C6 12.504 5.496 12 4.875 12m-1.5 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M19.125 12h1.5m0 0c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h1.5m14.25 0h1.5" />
            </svg>,
            active: authStatus
        },
        {
            name: "Sing Up",
            path: "/signup",
            svg: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                <path strokeLinecap="round" strokeLinejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
            </svg>,
            active: !authStatus
        },
        {
            name: "Login",
            path: "/login",
            svg: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                <path strokeLinecap="round" strokeLinejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
            </svg>,
            active: !authStatus
        },

    ]

    return (
        <>

            {hidden && (

                <aside id="sidebar" className={`fixed top-0 lg:top-5 left-0 z-20 flex flex-col flex-shrink-0 w-52 h-full pt-10 font-normal duration-75 lg:flex transition-width `}
                    aria-label="Sidebar">



                    <div className="relative flex flex-col flex-1 min-h-0 pt-0 bg-white  mt-3">
                        {/* {authStatus && (
                            <div className="sm:hidden px-3 pt-6 h-20 border-b border-gray-200">
                                <Link to="/your_channel" className="flex items-center gap-3" aria-label="Open your channel">
                                    {user?.avatar ? (
                                        <img src={user?.avatar || backupImage} alt={user?.name || 'Profile'} className="w-10 h-10 rounded-full object-cover" />
                                    ) : (
                                        <div className="w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-sm font-medium">
                                            {user?.name ? user.name.charAt(0).toUpperCase() : 'Y'}
                                        </div>
                                    )}
                                    <div className="flex flex-col">
                                        <span className="text-sm font-medium  text-gray-900">{user?.name || 'DemoUser'}</span>
                                        {<span className="text-xs text-gray-500 truncate">{user?.email || 'demo1@gmail.com'}</span>}
                                    </div>
                                </Link>
                            </div>
                        )} */}
                        {authStatus && (
  <div className="sm:hidden px-3 pt-6 pb-3 border-b border-gray-200">
    <Link to="/your_channel" className="flex items-center gap-3" aria-label="Open your channel">
      {user?.avatar ? (
        <img src={user?.avatar || backupImage} alt={user?.name || 'Profile'} className="w-10 h-10 rounded-full object-cover" />
      ) : (
        <div className="w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-sm font-medium">
          {user?.name ? user.name.charAt(0).toUpperCase() : 'Y'}
        </div>
      )}
      <div className="flex flex-col">
        <span className="text-sm font-medium text-gray-900">{user?.name || 'DemoUser'}</span>
        <span className="text-xs text-gray-500 truncate">{user?.email || 'demo1@gmail.com'}</span>
      </div>
    </Link>

    {/* Voice Docs row (mobile) with horizontal lines above & below */}
    {/* Voice Docs row (mobile) with icon and horizontal lines above & below */}
<div className="mt-3">
  <hr className="border-t border-gray-200" />
  <Link
    to="/docs"
    className="flex items-center justify-between mt-2 px-2 py-2 rounded hover:bg-gray-50 text-sm text-gray-900"
    aria-label="Open Voice Docs"
  >
    <div className="flex items-center gap-3">
      <div className="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100">
        <FiFileText className="w-5 h-5" />
      </div>
      <span>Voice Docs</span>
    </div>
    <span className="text-gray-400">&gt;</span>
  </Link>
  <hr className="border-t border-gray-200 mt-2" />
</div>

  </div>
)}


                        <div className="flex flex-col flex-1 pt-3 pb-4 overflow-y-auto">
                            <div className="flex-1 px-3 space-y-1 bg-white divide-y divide-gray-200 ">
                                <ul className="">
                                    {navItems.map((item, index) =>
                                        item.active ? (
                                            <li key={index} >
                                                <Link to={item.path} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
                                                    {item.svg}
                                                    <span className="ml-3" sidebar-toggle-item>
                                                        {item.name}
                                                    </span>
                                                </Link>
                                            </li>)
                                            : null)}

                                    {authStatus && (
                                        <>

                                            <div className='divide-y divide-gray-200' >
                                                <li>
                                                    <Link to={"/subscriptions"} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
                                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                                                            <path strokeLinecap="round" strokeLinejoin="round" d="M6 6.878V6a2.25 2.25 0 0 1 2.25-2.25h7.5A2.25 2.25 0 0 1 18 6v.878m-12 0c.235-.083.487-.128.75-.128h10.5c.263 0 .515.045.75.128m-12 0A2.25 2.25 0 0 0 4.5 9v.878m13.5-3A2.25 2.25 0 0 1 19.5 9v.878m0 0a2.246 2.246 0 0 0-.75-.128H5.25c-.263 0-.515.045-.75.128m15 0A2.25 2.25 0 0 1 21 12v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6c0-.98.626-1.813 1.5-2.122" />
                                                        </svg>
                                                        <span className="ml-3" sidebar-toggle-item>Subscriptions</span>
                                                    </Link>
                                                </li>
                                                <li>
                                                    <h1>You</h1>
                                                    <Link to={"/your_channel"} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
                                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                                                            <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
                                                        </svg>
                                                        <span className="ml-3" sidebar-toggle-item>Your Channel</span>
                                                    </Link>
                                                </li>
                                            </div>
                                            <li>
                                                <Link to={"/history"} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
                                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                                                        <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3" />
                                                    </svg>
                                                    <span className="ml-3" sidebar-toggle-item>History</span>
                                                </Link>
                                            </li>
                                            <li>
                                                <Link to={"/playlist"} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
                                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                                                        <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                                                    </svg>
                                                    <span className="ml-3" sidebar-toggle-item>Playlist</span>
                                                </Link>
                                            </li>
                                            <div className='divide-y divide-gray-200' >
                                                <li>
                                                    <Link to={"/like"} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
                                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                                                            <path strokeLinecap="round" strokeLinejoin="round" d="M6.633 10.25c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75a.75.75 0 0 1 .75-.75 2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282m0 0h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23H5.904m10.598-9.75H14.25M5.904 18.5c.083.205.173.405.27.602.197.4-.078.898-.523.898h-.908c-.889 0-1.713-.518-1.972-1.368a12 12 0 0 1-.521-3.507c0-1.553.295-3.036.831-4.398C3.387 9.953 4.167 9.5 5 9.5h1.053c.472 0 .745.556.5.96a8.958 8.958 0 0 0-1.302 4.665c0 1.194.232 2.333.654 3.375Z" />
                                                        </svg>
                                                        <span className="ml-3" sidebar-toggle-item>Like</span>
                                                    </Link>
                                                </li>
                                                <li>
                                                    <h1>Explore</h1>
                                                    <Link
                                                        to="/trending"
                                                        className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group"
                                                    >
                                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                                                            <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941" />
                                                        </svg>
                                                        <span className="ml-3" sidebar-toggle-item>Trending</span>
                                                    </Link>

                                                </li>
                                            </div>
                                            <li>
                                                <Link to={"/music"} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
                                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                                                        <path strokeLinecap="round" strokeLinejoin="round" d="m9 9 10.5-3m0 6.553v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 1 1-.99-3.467l2.31-.66a2.25 2.25 0 0 0 1.632-2.163Zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 0 1-.99-3.467l2.31-.66A2.25 2.25 0 0 0 9 15.553Z" />
                                                    </svg>
                                                    <span className="ml-3" sidebar-toggle-item>Music</span>
                                                </Link>
                                            </li>
                                            <div className='divide-y divide-gray-200' >
                                                <li>
                                                    <Link to={"/movies"} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
                                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                                                            <path strokeLinecap="round" strokeLinejoin="round" d="m3.75 7.5 16.5-4.125M12 6.75c-2.708 0-5.363.224-7.948.655C2.999 7.58 2.25 8.507 2.25 9.574v9.176A2.25 2.25 0 0 0 4.5 21h15a2.25 2.25 0 0 0 2.25-2.25V9.574c0-1.067-.75-1.994-1.802-2.169A48.329 48.329 0 0 0 12 6.75Zm-1.683 6.443-.005.005-.006-.005.006-.005.005.005Zm-.005 2.127-.005-.006.005-.005.005.005-.005.005Zm-2.116-.006-.005.006-.006-.006.005-.005.006.005Zm-.005-2.116-.006-.005.006-.005.005.005-.005.005ZM9.255 10.5v.008h-.008V10.5h.008Zm3.249 1.88-.007.004-.003-.007.006-.003.004.006Zm-1.38 5.126-.003-.006.006-.004.004.007-.006.003Zm.007-6.501-.003.006-.007-.003.004-.007.006.004Zm1.37 5.129-.007-.004.004-.006.006.003-.004.007Zm.504-1.877h-.008v-.007h.008v.007ZM9.255 18v.008h-.008V18h.008Zm-3.246-1.87-.007.004L6 16.127l.006-.003.004.006Zm1.366-5.119-.004-.006.006-.004.004.007-.006.003ZM7.38 17.5l-.003.006-.007-.003.004-.007.006.004Zm-1.376-5.116L6 12.38l.003-.007.007.004-.004.007Zm-.5 1.873h-.008v-.007h.008v.007ZM17.25 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Zm0 4.5a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z" />
                                                        </svg>
                                                        <span className="ml-3" sidebar-toggle-item>Movies</span>
                                                    </Link>
                                                </li>
                                                <li>
                                                    <Link to={"/settings"} className="flex items-center p-2 text-base text-gray-900 rounded-lg hover:bg-gray-100 group ">
                                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={'1.5'} stroke="currentColor" className="w-6 h-6">
                                                            <path strokeLinecap="round" strokeLinejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                                                            <path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                                        </svg>
                                                        <span className="ml-3" sidebar-toggle-item>Settings</span>
                                                    </Link>

                                                </li>
                                            </div>

                                            {/* ----------------- SUBSCRIPTIONS LIST (below Settings) ----------------- */}
                                            {/* Only channelName will be shown here (no subscribe button) */}
                                            <div className=" pt-2">
                                                {loadingSubs ? (
                                                    <div className="text-sm text-gray-500 px-2">Loading subscriptions...</div>
                                                ) : (
                                                    subscriptions.length > 0 && (
                                                        <div>
                                                            <h1 className='ml-0'>Your subscriptions</h1>
                                                            <ul className="space-y-1">
                                                                {subscriptions.map((s) => (
                                                                    <li key={s.channelId}>
                                                                        <Link
                                                                            to={`/channel/${s.channelId}`}
                                                                            className="flex items-center gap-3 p-2 rounded-md hover:bg-gray-100"
                                                                            title={s.channelName}
                                                                            aria-label={`Open ${s.channelName} channel`}
                                                                        >
                                                                            {/* Avatar (with fallback if image fails) */}
                                                                            <img
                                                                                src={s.channelAvatar || backupImage}
                                                                                alt={`${s.channelName} avatar`}
                                                                                className="w-6 h-6 rounded-full object-cover flex-shrink-0"
                                                                                loading="lazy"
                                                                                onError={(e) => {
                                                                                    e.currentTarget.onerror = null;
                                                                                    e.currentTarget.src = backupImage;
                                                                                }}
                                                                            />

                                                                            {/* Channel name (truncates if too long) */}
                                                                            <span className="truncate text-sm">{s.channelName}</span>

                                                                            {/* optional: subscriber count to the right
            <span className="text-xs text-gray-400 ml-auto">{s.subscribersCount}</span>
        */}
                                                                        </Link>
                                                                    </li>
                                                                ))}
                                                            </ul>

                                                        </div>
                                                    )
                                                )}
                                                {subsError && <div className="text-xs text-red-500 mt-1 px-2">Failed to load subscriptions</div>}
                                            </div>

                                        </>
                                    )}


                                </ul>
                            </div>
                        </div>
                    </div>
                </aside>
            )}
        </>
    )
}

export default Sidebar
